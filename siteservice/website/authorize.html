<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>It's You Online</title>

    <link rel='stylesheet prefetch'
          href='https://ajax.googleapis.com/ajax/libs/angular_material/1.0.7/angular-material.min.css'>
    <link rel="stylesheet" href="assets/css/style.css"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
    <link href='https://fonts.googleapis.com/css?family=Wellfleet|Arvo:400,700,400italic,700italic' rel='stylesheet'
          type='text/css'>
    <style>

        [ng\:cloak], [ng-cloak], .ng-cloak {
            display: none;
        }
    </style>
</head>

<body ng-app="itsyouonlineApp">

<header id="header">

  <div class="content">
    <div id="logo"><a href="#/"> ItsYou.Online </a></div>

    <div class="sign-wrap">
        <a href="#notifications"><i class="fa fa-bell"></i>
            <md-tooltip ng-cloak>
            You have no open requests
            </md-tooltip>
        </a>
        <md-menu md-offset="-5 30" ng-cloak>
            <a href="" ng-click="$mdOpenMenu($event)">
                <i class="fa fa-user"></i><span ng-bind="user"></span>
                <i class="fa fa-caret-down"></i></a>
            <md-menu-content ng-cloak>
               <md-menu-item><md-button href="/">Home</md-button></md-menu-item>
                <md-menu-item>
                    <md-button href="logout">Sign out</md-button>
                </md-menu-item>
             </md-menu-content>
        </md-menu>
    </div>
  </div>
</header>


<div class="background-image">
    <div flex layout="row" layout-fill style="padding-top: 100px;">
        <div flex></div>
        <div layout="column" flex-gt-xs="80" flex-xs="100" layout-fill ng-controller="AuthorizeController as vm">
            <div layout ng-cloak>
                <div flex="80">
                    <h1>{{ ::vm.requestingorganization }}</h1>
                    <p>Requests authorization to see some of your information</p>
                </div>
            </div>

            <form ng-cloak method="post" layout="column" name="authorizeform" ng-submit="vm.authorize()">
                <div layout="row">
                    <md-list flex="100" flex-gt-sm="80" flex-gt-md="60">
                        <md-list-item>
                            <p>
                                <i class="fa fa-user">
                                    <md-tooltip>Your username</md-tooltip>
                                </i>
                                Your username
                            </p>
                        </md-list-item>
                        <md-list-item ng-repeat="(label, value) in vm.requested.organizations">
                            <p><i class="fa fa-users">
                                <md-tooltip>Organization membership</md-tooltip>
                            </i>
                                Member of {{ ::label }}
                            </p>
                            <md-checkbox class="md-secondary"
                                         ng-model="vm.requested.organizations[label]"></md-checkbox>
                        </md-list-item>
                        <md-list-item ng-repeat="label in vm.requested.email">
                            <p>
                                <i class="fa fa-at">
                                    <md-tooltip>Email address</md-tooltip>
                                </i>
                                Email address<span ng-if="label && label !== 'main'">
                                for {{ ::label }}</span>
                            </p>
                            <md-input-container>
                                <label>Email</label>
                                <md-select ng-model="vm.authorizations.email[label]">
                                    <md-option ng-repeat="(label, email) in vm.user.email" value="{{::label}}"
                                               ng-bind="::email"></md-option>
                                </md-select>
                            </md-input-container>
                        </md-list-item>
                        <md-list-item ng-repeat="label in vm.requested.phone">
                            <p><i class="fa fa-phone">
                                <md-tooltip>Phone number</md-tooltip>
                            </i> Phone number <span ng-if="label && label !== 'main'">
                                for {{ ::label }}</span>
                            </p>
                            <md-input-container>
                                <label>Phone number</label>
                                <md-select ng-model="vm.authorizations.phone[label]">
                                    <md-option ng-repeat="(label, phone) in vm.user.phone" value="{{::label}}">
                                        {{ ::label + ' - ' + phone }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </md-list-item>
                        <md-list-item ng-repeat="label in vm.requested.address">
                            <p><i class="fa fa-envelope-o">
                                <md-tooltip>Address</md-tooltip>
                            </i> Address <span ng-if="label && label !== 'main'">
                                for {{ ::label }}</span>
                            </p>
                            <md-input-container>
                                <label>Address</label>
                                <md-select ng-model="vm.authorizations.address[label]">
                                    <md-option ng-repeat="(label, address) in vm.user.address" value="{{::label}}">
                                        {{ ::label + ' - ' + address.street
                                        + (address.nr? ' ' + address.nr : '')
                                        + (address.city? ' ' + address.city : '')
                                        }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </md-list-item>
                        <md-list-item ng-repeat="label in vm.requested.bank">
                            <p><i class="fa fa-bank">
                                <md-tooltip>Bank account</md-tooltip>
                            </i>
                                Bank account <span ng-if="label != '' && label != 'main'">
                                    for {{ ::label }}</span>
                            </p>
                            <md-input-container>
                                <label>Bank account</label>
                                <md-select ng-model="vm.authorizations.bank[label]">
                                    <md-option ng-repeat="(label, bank) in vm.user.bank" value="{{::label}}">
                                        {{ ::label + ' - ' + bank.bic + ', ' + bank.iban + ', ' + bank.country }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </md-list-item>
                        <md-list-item ng-if="vm.requested.github">
                            <p><i class="fa fa-github">
                                <md-tooltip>Github account</md-tooltip>
                            </i>
                                Your Github account
                            </p>
                            <md-checkbox class="md-secondary"
                                         ng-model="vm.authorizations.facebook"></md-checkbox>
                        </md-list-item>
                        <md-list-item ng-if="vm.requested.github">
                            <p><i class="fa fa-facebook-official">
                                <md-tooltip>Facebook account</md-tooltip>
                            </i>
                                Your Facebook account
                            </p>
                            <md-checkbox class="md-secondary"
                                         ng-model="vm.authorizations.github"></md-checkbox>
                        </md-list-item>
                    </md-list>
                    <div flex></div>
                </div>
                <div style="margin-top: 10px;">
                        <md-button type="submit" class="md-raised md-primary">Authorize</md-button>
                        <span flex></span>
                    </div>
            </form>
        </div>
        <div flex></div>
    </div>
</div>


<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.js"></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-cookies.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angular_material/1.0.7/angular-material.min.js'></script>
<script>
    if (!String.prototype.startsWith) {
        String.prototype.startsWith = function (str) {
            return this.lastIndexOf(str, 0) === 0;
        };
    }
    angular
        .module('itsyouonlineApp', ['ngCookies', 'ngMaterial','ngRoute', 'ngMessages'])
        .config(function($mdThemingProvider) {
            $mdThemingProvider.definePalette('blueish', {
                '50': '#f7fbfd',
                '100': '#badeed',
                '200': '#8ec8e2',
                '300': '#55add3',
                '400': '#3ca1cd',
                '500': '#3091bb',
                '600': '#2a7ea3',
                '700': '#236b8a',
                '800': '#1d5872',
                '900': '#17455a',
                'A100': '#f7fbfd',
                'A200': '#badeed',
                'A400': '#3ca1cd',
                'A700': '#236b8a',
                'contrastDefaultColor': 'light',
                'contrastDarkColors': '50 100 200 300 400 A100 A200 A400'
            });
            $mdThemingProvider.theme('default')
                    .primaryPalette('blueish');
        })
        .factory('authenticationInterceptor',['$q','$window', function($q, $window){
            return {
                'request': function(config) {
                    if (config) {
                        var url = config.url;

                        if( /(api\/)/i.test(url)){
                            config.headers["Authorization"] = "token " + sessionStorage.getItem("oauthToken");
                        }
                    }
                    return config || $q.when(config);
        	    },
        	    'response': function(response) {
                    return response || $q.when(response);
                },

               'responseError': function(rejection) {
                    if (rejection.status == 401 || rejection.status == 403 || rejection.status == 419){
              			$window.location.href = "/";
                    } else {
                        $window.location.href = "error" + reason.status;
                    }

                   return $q.reject(rejection);
                }
            };
    	}])
        .config(['$httpProvider',function($httpProvider) {
            $httpProvider.interceptors.push('authenticationInterceptor');
            //initialize get if not there
            if (!$httpProvider.defaults.headers.get) {
                $httpProvider.defaults.headers.get = {};
            }
            //disable IE ajax request caching
            $httpProvider.defaults.headers.get['If-Modified-Since'] = '0';
        }])
        .run(function($cookies, $rootScope, $location) {
            $rootScope.user = $cookies.get('itsyou.online.user');
            var at = $cookies.get('itsyou.online.apitoken');
            if (at){
                sessionStorage.setItem("oauthToken",at);
            }
        });
</script>
<script src='components/user/authorizeController.js'></script>
<script src='components/user/service.js'></script>
<script src='thirdpartyassets/URI.js'></script>
</body>
</html>
