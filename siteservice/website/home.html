<!DOCTYPE html>
<html lang="en">
  <head>
	   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
       <title>It's You Online</title>
      <link rel='stylesheet prefetch'
            href='https://ajax.googleapis.com/ajax/libs/angular_material/1.0.7/angular-material.min.css'>
       <link rel="stylesheet" href="assets/css/style.css"/>
       <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
       <link href='https://fonts.googleapis.com/css?family=Wellfleet|Arvo:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <style>

            [ng\:cloak], [ng-cloak], .ng-cloak {
                display: none;
            }
        </style>
 </head>

  <body ng-app="itsyouonlineApp">

<header id="header">

  <div class="content">
    <div id="logo"><a href="#/"> ItsYou.Online </a></div>

    <div class="sign-wrap">
        <a href="#notifications"><i class="fa fa-bell"></i>
            <md-tooltip ng-cloak>
            You have no open requests
            </md-tooltip>
        </a>
        <md-menu md-offset="-5 30">
            <a href="" ng-click="$mdOpenMenu($event)"><i class="fa fa-plus"></i><i class="fa fa-caret-down"></i>
              <md-tooltip ng-cloak>
                Create new...
              </md-tooltip>
            </a>
            <md-menu-content ng-cloak>
               <md-menu-item><md-button href="#neworganization">New organization</md-button></md-menu-item>
               <md-menu-item><md-button href="#newcompany">New company</md-button></md-menu-item>
             </md-menu-content>
        </md-menu>

        <md-menu md-offset="-5 30" ng-cloak>
            <a href="" ng-click="$mdOpenMenu($event)"><i class="fa fa-user"> {{ user }}</i><i class="fa fa-caret-down"></i></a>
            <md-menu-content ng-cloak>
               <md-menu-item><md-button href="#/">Home</md-button></md-menu-item>
               <md-menu-item><md-button href="logout">Signout</md-button></md-menu-item>
             </md-menu-content>
        </md-menu>
    </div>
  </div>

</header>


<div class="fullscreenform">
    <div flex layout="row" layout-fill style="padding-top: 100px;">
        <div flex></div>
        <div layout="column" flex-gt-xs="80" flex-xs="100" layout-fill>
            <div ng-view layout-fill></div>
        </div>
        <div flex></div>
    </div>
</div>


<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.js"></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-cookies.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angular_material/1.0.7/angular-material.min.js'></script>
<script src='components/configService.js'></script>
<script>
    angular
            .module('itsyouonlineApp', ['ngCookies', 'ngMaterial', 'ngRoute', 'ngMessages', 'itsyouonline.config'])
            .config(['$mdThemingProvider', function ($mdThemingProvider) {
            $mdThemingProvider.definePalette('blueish', {
                '50': '#f7fbfd',
                '100': '#badeed',
                '200': '#8ec8e2',
                '300': '#55add3',
                '400': '#3ca1cd',
                '500': '#3091bb',
                '600': '#2a7ea3',
                '700': '#236b8a',
                '800': '#1d5872',
                '900': '#17455a',
                'A100': '#f7fbfd',
                'A200': '#badeed',
                'A400': '#3ca1cd',
                'A700': '#236b8a',
                'contrastDefaultColor': 'light',
                'contrastDarkColors': '50 100 200 300 400 A100 A200 A400'
            });
            $mdThemingProvider.theme('default')
                    .primaryPalette('blueish');
            }])
        .factory('authenticationInterceptor',['$q','$window', function($q, $window){
            return {
                'request': function(config) {
                    if (config) {
                        var url = config.url;

                        if( /(api\/)/i.test(url)){
                            config.headers["Authorization"] = "token " + sessionStorage.getItem("oauthToken");
                        }
                    }
                    return config || $q.when(config);
        	    },
        	    'response': function(response) {
                    return response || $q.when(response);
                },

               'responseError': function(rejection) {
                    if (rejection.status == 401 || rejection.status == 403 || rejection.status == 419){
              			$window.location.href = "";
               	   }

                   return $q.reject(rejection);
                }
            };
    	}])
        .config(['$httpProvider',function($httpProvider) {
            $httpProvider.interceptors.push('authenticationInterceptor');
            //initialize get if not there
            if (!$httpProvider.defaults.headers.get) {
                $httpProvider.defaults.headers.get = {};
            }
            //disable IE ajax request caching
            $httpProvider.defaults.headers.get['If-Modified-Since'] = '0';
        }])
            .config(['$routeProvider', function ($routeProvider) {
            $routeProvider
                .when('/', {
                    templateUrl: 'components/user/views/home.html',
                    controller: 'UserHomeController',
                    controllerAs: 'vm'
                })
                .when('/neworganization', {
                    templateUrl: 'components/organization/views/new.html',
                    controller: 'OrganizationController',
                    controllerAs: 'vm'
                })
                .when('/organizations/:globalid/newsuborganization', {
                    templateUrl: 'components/organization/views/new.html',
                    controller: 'OrganizationController',
                    controllerAs: 'vm'
                })
                .when('/organizations/:globalid', {
                    templateUrl: 'components/organization/views/detail.html',
                    controller: 'OrganizationDetailController',
                    controllerAs: 'vm'
                })
                .when('/newcompany', {
                    templateUrl: 'components/company/views/new.html',
                    controller: 'CompanyController',
                    controllerAs: 'vm'
                })
                .when('/companies/:globalid', {
                    templateUrl: 'components/company/views/detail.html',
                    controller: 'CompanyController',
                    controllerAs: 'vm'
                })
                .otherwise({redirectTo: '/' })
            ;
            }])
            .run(['$cookies', '$rootScope', '$location', function ($cookies, $rootScope, $location) {
            var pathParts = $location.path().split("=");
                if (pathParts.length === 2 && pathParts[0] === "/token") {
                    sessionStorage.setItem("oauthToken", pathParts[1]);
                $location.path("/");
                $location.replace();
            }
            $rootScope.user = $cookies.get('itsyou.online.user');
            }]);
</script>
<script src='components/user/controller.js'></script>
<script src='components/user/service.js'></script>
<script src='components/user/directives/authorizationDetailsDirective.js'></script>
<script src='components/organization/controller.js'></script>
<script src='components/organization/service.js'></script>
<script src='components/company/controller.js'></script>
<script src='components/company/service.js'></script>
</body>
</html>
